<project name="clojure-jsr223" default="jar">

	<description>
		NOTE: Requires ant 1.7.0+ (due to the service-task, which only
		exists since 1.7.0). Sorry for any inconvenience this might
		cause.

		Builds clojure-jsr223.jar, which will contain the
		implementation of a JSR 223-compliant wrapper around Clojure.
		To compile and use it, you must have built clojure.jar and
		added it to your classpath.

		To test it, you can use something like:
		jrunscript -cp clojure-jsr223.jar:/my/path/to/clojure.jar -l "Clojure"
	</description>

	<property name="src" location="src"/>
	<property name="build" location="build"/>
	<property name="clojure_jsr223_jar" location="clojure-jsr223.jar"/>

	<target name="init">
		<tstamp/>
		<mkdir dir="${build}"/>
	</target>

	<target name="compile" depends="init"
		description="Compile sources.">
		<!-- target must be 1.6, since javax.script did not exist before -->
		<javac srcdir="${src}" destdir="${build}" includeJavaRuntime="yes" debug="true" target="1.6"/>
	</target>

	<target name="jar" depends="compile"
		description="Create jar file.">
		<jar jarfile="${clojure_jsr223_jar}" basedir="${build}">
			<service type="javax.script.ScriptEngineFactory" provider="de.torq.clojure.jsr223.ClojureScriptEngineFactory"/>
		</jar>
	</target>

	<target name="clean"
		description="Remove autogenerated files and directories.">
		<delete dir="${build}"/>
	</target>

</project>
